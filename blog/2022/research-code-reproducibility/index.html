<!DOCTYPE html> <html lang="en-us"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="g-X-aUUud1gtIVUgKEAx9T7VKpcQw1Ymd8aQ-hlIIY8"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> The problem of research code reproducibility | George C. de Araújo </title> <meta name="author" content="George C. de Araújo"> <meta name="description" content="A brief overview of the problem of research code reproducibility."> <meta name="keywords" content="machine learning, artificial intelligence, deep learning, computer vision, natural language processing"> <meta property="og:site_name" content="George C. de Araújo"> <meta property="og:type" content="article"> <meta property="og:title" content="George C. de Araújo | The problem of research code reproducibility"> <meta property="og:url" content="https://george-gca.github.io/blog/2022/research-code-reproducibility/"> <meta property="og:description" content="A brief overview of the problem of research code reproducibility."> <meta property="og:image" content="assets/img/profile_pic.png"> <meta property="og:image:alt" content="Profile picture"> <meta property="og:locale" content="en-us"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="The problem of research code reproducibility"> <meta name="twitter:description" content="A brief overview of the problem of research code reproducibility."> <meta name="twitter:image" content="assets/img/profile_pic.png"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "George C. de Araújo"
        },
        "url": "https://george-gca.github.io/blog/2022/research-code-reproducibility/",
        "@type": "BlogPosting",
        "description": "A brief overview of the problem of research code reproducibility.",
        "headline": "The problem of research code reproducibility",
        
        "sameAs": ["https://orcid.org/0000-0002-7658-2786", "https://scholar.google.com/citations?user=kSVOrakAAAAJ", "http://lattes.cnpq.br/8522827733075951", "https://www.researchgate.net/profile/George-De-Araujo", "https://github.com/george-gca", "https://www.linkedin.com/in/georgecdearaujo", "https://dblp.org/pid/331/0630.html"],
        
        "name": "George C. de Araújo",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%A8%F0%9F%8F%BD%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://george-gca.github.io/blog/2022/research-code-reproducibility/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">George</span> C. de Araújo </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">Bio </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item active"> <a class="nav-link" href="/pt-br/blog/2022/research-code-reproducibility/"> PT-BR</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main" style="--stagger: 0;" data-animate> <div class="post"> <header class="post-header"> <h1 class="post-title">The problem of research code reproducibility</h1> <p class="post-meta" style="--stagger: 1;" data-animate=""> Created in October 21, 2022 </p> <p class="post-tags" style="--stagger: 2;" data-animate=""> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/research"> <i class="fa-solid fa-hashtag fa-sm"></i> research</a>   <a href="/blog/tag/programming"> <i class="fa-solid fa-hashtag fa-sm"></i> programming</a>   <a href="/blog/tag/reproducibility"> <i class="fa-solid fa-hashtag fa-sm"></i> reproducibility</a>   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/research-code"> <i class="fa-solid fa-tag fa-sm"></i> research-code</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p style="--stagger: 3;" data-animate="">Everyone in the research community had that problem already:</p> <blockquote style="--stagger: 4;" data-animate=""> <p style="--stagger: 5;" data-animate="">You found a paper that you want to reproduce. You found out that the original author (or possibly another researcher) published code to run those experiments. You download the code, try to run it, but it doesn’t work. There are missing code, missing datasets, or missing dependencies. Maybe the code is a little outdated, and you need to update it to run it on your machine. Or you need to find out which specific library versions the authors used. You spend hours trying to get the code to run, but to no avail. You try to contact the authors, but they do not respond. You try to fix the code yourself, but it is too complicated. You give up.</p> </blockquote> <p style="--stagger: 6;" data-animate="">Who never got so frustrated to the point that you just give up on that code, maybe even on that paper? Hell, I know people that gave up on a whole field of research because they could not reproduce the results of a paper. Multiple times I got caught in this kind of situation, and got me questioning the whole code publishing part. After a lot of afterthought, I came to a partial solution to this problem.</p> <h2 id="the-main-culprit" style="--stagger: 7;" data-animate="">The main culprit</h2> <p style="--stagger: 8;" data-animate="">Most of the time that I am unable to run someone else’s code, it is because of one thing: <strong>dependencies versions are not specified</strong>.</p> <p style="--stagger: 9;" data-animate="">Sure, a lot of people create something like <code class="language-plaintext highlighter-rouge">requirements.txt</code>, but they usually lack the version number. Even if they do specify the version number, it is usually not the exact version number. For example, instead of <code class="language-plaintext highlighter-rouge">numpy==1.19.5</code>, they would write <code class="language-plaintext highlighter-rouge">numpy&gt;=1.19.5</code>. This is not good enough. If you want to reproduce someone else’s results, you need to know <strong>exactly</strong> which version of each dependency you need to install. Otherwise, you will get different results. Even if you specify the exact version number, you might still get different results if the authors used a different version of the language, say, Python, or some other low-level dependencies, like cuda or cuDNN.</p> <h2 id="docker-for-the-help" style="--stagger: 10;" data-animate="">Docker for the help</h2> <p style="--stagger: 11;" data-animate="">That is where <a href="https://www.docker.com/" rel="external nofollow noopener" target="_blank">Docker</a> comes in. Docker is a <a href="https://www.docker.com/resources/what-container/" rel="external nofollow noopener" target="_blank">containerization technology</a> that allows you to create an <a href="https://docs.docker.com/glossary/#image" rel="external nofollow noopener" target="_blank">image</a> that packs all the dependencies that you need to run your code. You can then run your code inside a <a href="https://docs.docker.com/glossary/#container" rel="external nofollow noopener" target="_blank">container</a>, and you will <strong>possibly</strong> get the same results as the authors. Making an allusion to object oriented programming, <strong>image</strong> is the class and <strong>container</strong> is an object or an instance from that class. You can even share that image with other people, so they can run your code too. Docker also supports <a href="https://github.com/NVIDIA/nvidia-docker" rel="external nofollow noopener" target="_blank">running code on GPUs</a>.</p> <p style="--stagger: 12;" data-animate="">As an example, here is the <a href="https://github.com/george-gca/sr-pytorch-lightning" rel="external nofollow noopener" target="_blank">base code</a> that I used during my master degree. I tried as much as possible to make it reproducible and extensible. That means to not only run the AI model, but also be able to create your own model and run it with the same data and training parameters, to allow comparisons.</p> <p style="--stagger: 13;" data-animate="">I decided to split the logic of dealing with Docker (contained in <a href="https://github.com/george-gca/sr-pytorch-lightning/blob/main/Makefile" rel="external nofollow noopener" target="_blank">Makefile</a>) from running the Python code itself (contained in <a href="https://github.com/george-gca/sr-pytorch-lightning/blob/main/start_here.sh" rel="external nofollow noopener" target="_blank">start_here.sh</a>). The recipe for creating the Docker image is inside the <a href="https://github.com/george-gca/sr-pytorch-lightning/blob/main/Dockerfile" rel="external nofollow noopener" target="_blank">Dockerfile</a>, and I also made available a <a href="https://github.com/george-gca/sr-pytorch-lightning/blob/main/Dockerfile_fixed_versions" rel="external nofollow noopener" target="_blank">Dockerfile</a> with all the versions of the dependencies fixed, like you can see in the code snippet below. Everything you might need to run the code is explained in the <a href="https://github.com/george-gca/sr-pytorch-lightning/blob/main/README.md" rel="external nofollow noopener" target="_blank">README</a> file.</p> <div class="language-bash highlighter-rouge" style="--stagger: 14;" data-animate=""><div class="highlight"><pre class="highlight"><code>    <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive <span class="nv">$APT_INSTALL</span> <span class="se">\</span>
        <span class="nv">bc</span><span class="o">=</span>1.07.1-2 <span class="se">\</span>
        <span class="nv">curl</span><span class="o">=</span>7.58.0-2ubuntu3.18 <span class="se">\</span>
        <span class="nv">git</span><span class="o">=</span>1:2.17.1-1ubuntu0.11 <span class="se">\</span>
        libffi-dev<span class="o">=</span>3.2.1-8 <span class="se">\</span>
        <span class="nv">rsync</span><span class="o">=</span>3.1.2-2.1ubuntu1.4 <span class="se">\</span>
        <span class="nv">wget</span><span class="o">=</span>1.19.4-1ubuntu2.2 <span class="o">&amp;&amp;</span> <span class="se">\</span>

<span class="c"># ==================================================================</span>
<span class="c"># install python libraries via pip</span>
<span class="c"># ------------------------------------------------------------------</span>

    <span class="nv">$PIP_INSTALL</span> <span class="se">\</span>
        <span class="nv">pip</span><span class="o">==</span>22.0.4 <span class="se">\</span>
        <span class="nv">setuptools</span><span class="o">==</span>62.2.0 <span class="se">\</span>
        <span class="nv">wheel</span><span class="o">==</span>0.37.1 <span class="o">&amp;&amp;</span> <span class="se">\</span>
</code></pre></div></div> <p style="--stagger: 15;" data-animate="">To ensure reproducibility despite the random number generators, I used the <a href="https://pytorch-lightning.readthedocs.io/en/stable/api/pytorch_lightning.utilities.seed.html#pytorch_lightning.utilities.seed.seed_everything" rel="external nofollow noopener" target="_blank">seed_everything</a> function from PyTorch Lightning. This function sets seed for pseudo-random number generators in: <code class="language-plaintext highlighter-rouge">pytorch</code>, <code class="language-plaintext highlighter-rouge">numpy</code>, <code class="language-plaintext highlighter-rouge">python.random</code>. It also sets the following environment variables: <code class="language-plaintext highlighter-rouge">PL_GLOBAL_SEED</code> and <code class="language-plaintext highlighter-rouge">PL_SEED_WORKERS</code>.</p> <h2 id="docker-doesnt-solve-everything" style="--stagger: 16;" data-animate="">Docker doesn’t solve everything</h2> <p style="--stagger: 17;" data-animate="">As you can probably be thinking, this is not a perfect solution. There are still problems that might surge, and that you need to be aware of, since some of these are from out of our control.</p> <h3 id="repositories-changes" style="--stagger: 18;" data-animate="">Repositories changes</h3> <p style="--stagger: 19;" data-animate="">Look, for example, this part of the <a href="https://github.com/george-gca/sr-pytorch-lightning/blob/main/Dockerfile_fixed_versions" rel="external nofollow noopener" target="_blank">Dockerfile</a>:</p> <div class="language-bash highlighter-rouge" style="--stagger: 20;" data-animate=""><div class="highlight"><pre class="highlight"><code><span class="c"># temporary solution for bug</span>
<span class="c"># see https://forums.developer.nvidia.com/t/gpg-error-http-developer-download-nvidia-com-compute-cuda-repos-ubuntu1804-x86-64/212904/3</span>
apt-key adv <span class="nt">--fetch-keys</span> https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64/3bf863cc.pub <span class="o">&amp;&amp;</span> <span class="se">\</span>
apt-key adv <span class="nt">--fetch-keys</span> https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/3bf863cc.pub <span class="o">&amp;&amp;</span> <span class="se">\</span>
</code></pre></div></div> <p style="--stagger: 21;" data-animate="">This is a solution for a bug that I found with the NVIDIA repository. Basically, they are (were?) in the process of rotating their repository GPG public keys, which is used to sign the packages. This was causing an error in the <code class="language-plaintext highlighter-rouge">apt-get update</code> command when creating the Docker image, and this was not happening during the entirety of my experiments, but happened by the time I decided to publish this code.</p> <h3 id="dependencies-dependencies">Dependencies’ dependencies</h3> <p>Sometimes some of your dependencies specific version requires specific versions of its own dependencies. This happened to me when specifying <code class="language-plaintext highlighter-rouge">tensorboard==2.9.0</code>, which caused an error when building the Docker image. To fix this, I needed to define the proper <code class="language-plaintext highlighter-rouge">protobuf</code> version to install, even though my code does not use <code class="language-plaintext highlighter-rouge">protobuf</code> directly.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">prettytable</span><span class="o">==</span>3.3.0 <span class="se">\</span>
<span class="c"># specify protobuf to avoid bug with tensorboard</span>
<span class="c"># https://developers.google.com/protocol-buffers/docs/news/2022-05-06#python-updates</span>
<span class="nv">protobuf</span><span class="o">==</span>3.20 <span class="se">\</span>
pytorch-lightning<span class="o">==</span>1.6.3 <span class="se">\</span>
<span class="nv">tensorboard</span><span class="o">==</span>2.9.0 <span class="se">\</span>
</code></pre></div></div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12"> Enjoy Reading This Article? </h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/dual-language-al-folio/">Turning your al-folio into a dual-language website</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/running-local-al-folio/">Running locally your own al-folio website</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/simple-improvements-python-code/">Improving your python code with simple tricks</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/localized-blog/">Creating localized blog posts</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/localized-projects/">Creating localized Projects pages</a> </li> <div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"george-gca/george-gca.github.io","data-repo-id":"R_kgDOI66tbw","data-category":"Announcements","data-category-id":"DIC_kwDOI66tb84CUDq6","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 George C. de Araújo. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/george-gca/multi-language-al-folio" rel="external nofollow noopener" target="_blank">multi-language-al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?ec82345cb41d6fd19bf9dfe5403e38e4"></script> <script defer src="/assets/js/common.js?0a3802ad0537cb758572d8fdeb0b31a9"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7KHS011G7"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-J7KHS011G7");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>